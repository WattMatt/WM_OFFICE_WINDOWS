<Page
    x:Name="MyPage"
    x:Class="WMOffice.Views.InspectionListPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:WMOffice.Views"
    xmlns:vm="using:WMOffice.ViewModels"
    xmlns:converters="using:WMOffice.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Page.DataContext>
        <vm:InspectionListViewModel/>
    </Page.DataContext>

    <Page.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </Page.Resources>

    <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="300"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Master View (List) -->
        <Grid Grid.Column="0" BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}" BorderThickness="0,0,1,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <StackPanel Grid.Row="0" Padding="12" Spacing="8">
                <TextBlock Text="Inspections" Style="{StaticResource TitleTextBlockStyle}"/>
                <TextBox PlaceholderText="New Inspection Description" Text="{Binding NewInspectionDescription, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                <TextBox PlaceholderText="Inspector Name" Text="{Binding NewInspectorName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                <Button Content="Add Inspection" Command="{Binding AddInspectionCommand}" HorizontalAlignment="Stretch"/>
            </StackPanel>

            <ListView Grid.Row="1" ItemsSource="{Binding Inspections}" SelectedItem="{Binding SelectedInspection, Mode=TwoWay}" Padding="12">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Padding="8">
                            <TextBlock Text="{Binding Description}" Style="{StaticResource SubtitleTextBlockStyle}"/>
                            <TextBlock Text="{Binding InspectorName}" Style="{StaticResource CaptionTextBlockStyle}" Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"/>
                            <TextBlock Text="{Binding Date}" Style="{StaticResource CaptionTextBlockStyle}" Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"/>
                        </StackPanel>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
            
            <ProgressRing IsActive="{Binding IsLoading}" Grid.Row="1" HorizontalAlignment="Center" VerticalAlignment="Center"/>
        </Grid>

        <!-- Detail View -->
        <Grid Grid.Column="1" Padding="24" Visibility="{Binding IsInspectionSelected, Converter={StaticResource BoolToVisibilityConverter}}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <StackPanel Grid.Row="0" Spacing="12">
                <TextBlock Text="{Binding SelectedInspection.Description}" Style="{StaticResource HeaderTextBlockStyle}"/>
                <TextBlock Text="{Binding SelectedInspection.InspectorName}" Style="{StaticResource SubtitleTextBlockStyle}"/>
                <TextBlock Text="{Binding SelectedInspection.Date}" Style="{StaticResource BodyTextBlockStyle}"/>
            </StackPanel>

            <CommandBar Grid.Row="1" DefaultLabelPosition="Right" Background="Transparent">
                <AppBarButton Icon="Delete" Label="Delete" Command="{Binding DeleteInspectionCommand}"/>
            </CommandBar>

            <ListView Grid.Row="2" ItemsSource="{Binding SelectedInspection.Photos}">
                 <ListView.ItemTemplate>
                     <DataTemplate>
                         <Image Source="{Binding FilePath}" Width="100" Height="100"/>
                     </DataTemplate>
                 </ListView.ItemTemplate>
             </ListView>
        </Grid>

        <!-- Empty State -->
        <TextBlock Grid.Column="1" Text="Select an inspection to view details." Style="{StaticResource SubtitleTextBlockStyle}" 
                   HorizontalAlignment="Center" VerticalAlignment="Center" 
                   Visibility="{Binding IsInspectionSelected, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Inverse}"/>
                   
    </Grid>
</Page>
